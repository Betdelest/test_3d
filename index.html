<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Projet BETL</title>

<script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>

<style>

  :root{
    --bg:#050816;
    --card:#07102a;
    --muted:#9aa6b2;
    --accent:#0a84ff;
  }

  html,body{
    height:100%;
    margin:0;
    background:var(--bg);
    color:#fff;
    font-family:Inter,Arial,Helvetica,sans-serif;
    overflow-x:hidden;
  }

  /* HEADER FIX + RESPONSIVE */
  header{
    display:flex;
    flex-wrap:wrap;
    align-items:center;
    gap:12px;
    padding:10px 14px;
    background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);
    box-shadow:0 6px 18px rgba(0,0,0,0.35);
  }

  .logo{
    height:72px;
    width:72px;
    max-width:80px;
    max-height:80px;
    object-fit:contain;
    border-radius:8px;
    cursor:pointer;
  }

  .titleWrap{ display:flex; flex-direction:column; min-width:0; }

  .title{ font-weight:800; font-size:20px; }
  .subtitle{ font-size:12px; color:var(--muted); }

  .hdr-controls{
    margin-left:auto;
    display:flex;
    gap:8px;
  }

  select.model-select{
    background:transparent;
    border:1px solid rgba(255,255,255,0.06);
    border-radius:8px;
    padding:8px 10px;
    color:#fff;
    min-width:170px;
  }

  /* GRID LAYOUT */
  .container{
    padding:12px;
    display:grid;
    grid-template-columns:1fr 320px;
    gap:12px;
  }

  @media(max-width:980px){
    .container{ grid-template-columns:1fr; }
    aside.card{ order:2; }
    main.card{ order:1; }
    .logo{ height:54px; width:54px; }
  }

  main.card, aside.card{
    background:var(--card);
    border-radius:10px;
    padding:12px;
  }

  model-viewer{
    width:100%;
    height:58vh;
    background:#111;
    border-radius:10px;
  }

  /* LOADER */
  .progress-wrap{ display:flex; gap:10px; margin-top:10px; }
  .progress{ flex:1; height:8px; background:#111; border-radius:999px; }
  .progress span{ height:100%; display:block; width:0; background:linear-gradient(90deg,var(--accent),#4bd3ff); }

  /* SPLASH */
  .splash{
    position:fixed; inset:0;
    background:#000;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    z-index:2000;
  }
  .splash.hidden{ display:none; }
  .splash-logo{
    width:220px;
    max-width:80vw;
    max-height:220px;
    object-fit:contain;
  }

  /* PLANS + DOCUMENTS */
  .plans-docs{
    padding:12px;
    border-radius:8px;
    background:rgba(255,255,255,0.03);
  }

  .pd-header h3{ margin:0; font-size:17px; font-weight:700; }

  .pd-search{
    width:100%;
    padding:8px 10px;
    margin-top:10px;
    border-radius:8px;
    border:1px solid rgba(255,255,255,0.1);
    background:#0004;
    color:#fff;
  }

  .pd-categories{
    display:flex;
    gap:6px;
    margin-top:12px;
    flex-wrap:wrap;
  }

  .pd-category-btn{
    background:transparent;
    border:1px solid rgba(255,255,255,0.1);
    padding:6px 14px;
    border-radius:8px;
    color:#fff;
    cursor:pointer;
  }
  .pd-category-btn.active{
    background:var(--accent);
    border-color:var(--accent);
    color:#fff;
    font-weight:700;
  }

  .pd-grid{ margin-top:12px; display:flex; flex-direction:column; gap:10px; }

  .pd-card{
    display:flex;
    justify-content:space-between;
    background:rgba(255,255,255,0.04);
    padding:12px;
    border-radius:10px;
  }

  .pd-title{ font-size:14px; font-weight:600; }
  .pd-meta{ font-size:12px; color:var(--muted); }

  .btn{
    background:var(--accent);
    border:0;
    padding:6px 14px;
    color:#fff;
    border-radius:8px;
    cursor:pointer;
    font-weight:600;
  }

  .btn-ghost{
    background:transparent;
    border:1px solid rgba(255,255,255,0.2);
    padding:6px 14px;
    color:#fff;
    border-radius:8px;
    cursor:pointer;
  }

  /* FOOTER */
  .betl-footer{
    margin-top:22px;
    padding:16px;
    text-align:center;
    border-top:1px solid rgba(255,255,255,0.06);
    color:#8fa3b5;
    font-size:13px;
  }
  .betl-footer .f-title{ font-size:16px; font-weight:700; color:#fff; }
  .betl-footer .f-slogan{ color:#4cc3ff; font-size:12px; margin-top:4px; }
  .betl-footer .f-line{ margin-top:6px; }
  .betl-footer .f-copy{ color:#6f7c88; margin-top:10px; font-size:11px; }

  /* MODAL */
  .modal-backdrop{
    position:fixed; inset:0;
    background:rgba(0,0,0,0.6);
    display:none;
    align-items:center;
    justify-content:center;
    z-index:1500;
  }
  .modal{
    width:min(95%,900px);
    height:min(90vh,900px);
    background:#08101a;
    border-radius:10px;
    display:flex;
    flex-direction:column;
    overflow:hidden;
  }
  .modal-header{
    padding:10px;
    border-bottom:1px solid rgba(255,255,255,0.1);
    display:flex;
    justify-content:space-between;
  }
  .modal-body{ flex:1; background:#000; }
  .preview-iframe{ width:100%; height:100%; border:0; }

</style>
</head>

<body>

<!-- SPLASH -->
<div id="splash" class="splash">
  <img class="splash-logo" src="BETL.png">
  <div style="color:var(--muted);margin-top:8px">
    Chargement‚Ä¶ <span id="splashPct">0%</span>
  </div>
</div>

<!-- HEADER -->
<header>
  <img class="logo" src="BETL.png"
       onclick="window.open('https://www.facebook.com/BETL120','_blank')">
  <div class="titleWrap">
    <div class="title">BETL ‚Äî Visualisation 3D & Plans</div>
    <div class="subtitle">Voir ta maison avant de l'habiter</div>
  </div>

  <div id="hdrControls" class="hdr-controls"></div>
</header>

<!-- CONTENT -->
<div class="container">

  <!-- 3D VIEW -->
  <main class="card">
    <div style="display:flex;justify-content:space-between;margin-bottom:6px">
      <div style="font-weight:700">Aper√ßu 3D</div>
      <div style="color:var(--muted);font-size:12px">
        2 mod√®le(s)
      </div>
    </div>

    <model-viewer id="viewer"
           src="models/Djanet_arch.glb"
           ar ar-modes="scene-viewer webxr"
           camera-controls>
           <button slot="ar-button" class="btn">Voir en AR</button>
         </model-viewer>

    <div id="progressWrap" class="progress-wrap" style="">
      <div class="progress"><span id="progressBar"></span></div>
      <div class="progress-label" id="progressLabel">0%</div>
    </div>
  </main>

  <!-- DOCUMENTS -->
  <aside class="card">

    <div style="display:flex;justify-content:space-between;">
      <div style="font-weight:700">Plans & Documents</div>
      <div style="font-size:12px;color:var(--muted)">
        3 fichier(s)
      </div>
    </div>

    <div class="plans-docs">

      <header class="pd-header">
        <h3>Plans & Documents</h3>
      </header>

      <input id="pd-search" class="pd-search"
             placeholder="Rechercher un document‚Ä¶">

      <div id="pd-categories" class="pd-categories"></div>

      <div id="pd-grid" class="pd-grid"></div>
    </div>

    <!-- FOOTER -->
    <footer class="betl-footer">
      <div class="f-title">BETL ‚Äî Bureau d‚Äô√âtudes Techniques</div>
      <div class="f-slogan">Voir ta maison avant de l'habiter</div>

      <div class="f-line">üìç Z.I Chihani Bachir, El Khroub, Constantine</div>
      <div class="f-line">üìû 0558 11 55 36 ‚Ä¢ üìß bureautechniquedelest@gmail.com</div>
      <div class="f-line">üåê Facebook : BETL120</div>

      <div class="f-copy">¬© 2025 BETL ‚Äî Tous droits r√©serv√©s</div>
    </footer>

  </aside>
</div>

<!-- MODAL -->
<div id="previewModal" class="modal-backdrop">
  <div class="modal">
    <div class="modal-header">
      <div id="previewTitle"></div>
      <button class="btn-ghost" onclick="closePreview()">Fermer</button>
    </div>
    <div class="modal-body">
      <iframe id="previewIframe" class="preview-iframe"></iframe>
    </div>
  </div>
</div>

<script>

const MODELS = ["Djanet_arch.glb","Djanet_gc.glb"];
const PDFS = {"Architecture":["bentelha permis -modi02 mise en page-Model.pdf"],"GC":["permis (1)-Model.pdf"],"Autre":["BETL.png"]};

/* HEADER SELECTOR */
(function(){
  if(!MODELS.length) return;
  const hdr=document.getElementById('hdrControls');
  const sel=document.createElement('select');
  sel.className='model-select';

  const opt=document.createElement('option');
  opt.textContent='Choisir mod√®le 3D';
  opt.value='';
  sel.appendChild(opt);

  MODELS.forEach(m=>{
    const o=document.createElement('option');
    o.value='models/'+m;
    o.textContent=m;
    sel.appendChild(o);
  });

  sel.onchange=()=>{ document.getElementById('viewer').src=sel.value; };

  hdr.appendChild(sel);
})();

/* DOCS ARRAY */
const DOCS=[];
Object.keys(PDFS).forEach(cat=>{
  const pretty = (cat==="GC" ? "G√©nie Civil" : cat);
  PDFS[cat].forEach(file=>{
    DOCS.push({
      title:file,
      category:pretty,
      file:"pdfs/"+cat+"/"+encodeURIComponent(file)
    });
  });
});

/* DOCUMENT UI */
(function(){

  const pdGrid=document.getElementById('pd-grid');
  const pdCats=document.getElementById('pd-categories');
  const pdSearch=document.getElementById('pd-search');

  let active="Tous";

  function renderCats(){
    pdCats.innerHTML="";
    const cats=["Tous","Architecture","G√©nie Civil","Autre"]
      .filter(c => c==="Tous" || DOCS.some(d=>d.category===c));

    cats.forEach(c=>{
      const b=document.createElement('button');
      b.className='pd-category-btn';
      b.textContent=c;
      if(c===active) b.classList.add('active');
      b.onclick=()=>{ active=c; renderCats(); renderList(); };
      pdCats.appendChild(b);
    });
  }

  function renderList(){
    pdGrid.innerHTML="";
    const q=pdSearch.value.toLowerCase().trim();

    const filtered = DOCS.filter(d=>{
      const okCat=(active==="Tous") || (d.category===active);
      const okSearch=d.title.toLowerCase().includes(q);
      return okCat && okSearch;
    });

    if(!filtered.length){
      const msg=document.createElement('div');
      msg.style="padding:10px;text-align:center;color:var(--muted)";
      msg.textContent="Aucun document trouv√©.";
      pdGrid.appendChild(msg);
      return;
    }

    filtered.forEach(doc=>{
      const card=document.createElement('div');
      card.className='pd-card';

      const L=document.createElement('div');
      L.style.flex="1";

      const t=document.createElement('div');
      t.className='pd-title';
      t.textContent=doc.title;

      const m=document.createElement('div');
      m.className='pd-meta';
      m.textContent=doc.category;

      L.appendChild(t);
      L.appendChild(m);

      const R=document.createElement('div');
      R.style.display="flex";
      R.style.gap="8px";

      const b1=document.createElement('button');
      b1.className='btn';
      b1.textContent='Voir';
      b1.onclick=()=>openPreview(doc.title,doc.file);

      const b2=document.createElement('button');
      b2.className='btn-ghost';
      b2.textContent='D√©tails';
      b2.onclick=()=>alert("D√©tails: "+doc.title);

      R.appendChild(b1);
      R.appendChild(b2);

      card.appendChild(L);
      card.appendChild(R);

      pdGrid.appendChild(card);
    });
  }

  pdSearch.oninput=renderList;

  renderCats();
  renderList();

})();

/* PDF PREVIEW */
function openPreview(title,file){
  document.getElementById('previewTitle').textContent=title;
  document.getElementById('previewIframe').src=file;
  document.getElementById('previewModal').style.display='flex';
}
function closePreview(){
  document.getElementById('previewModal').style.display='none';
  document.getElementById('previewIframe').src="";
}

/* SPLASH LOADER */
document.addEventListener('DOMContentLoaded',()=>{
  const v=document.getElementById('viewer');
  if(!v) return;
  const p=document.getElementById('progressBar');
  const pctText=document.getElementById('progressLabel');
  const s=document.getElementById('splash');
  const sPct=document.getElementById('splashPct');

  v.addEventListener('progress',e=>{
    const pct=Math.floor((e.detail.totalProgress||0)*100);
    p.style.width=pct+"%";
    pctText.textContent=pct+"%";
    sPct.textContent=pct+"%";

    if(pct>=100){
      setTimeout(()=> s.classList.add('hidden'),400);
    }
  });
});

</script>

</body>
</html>