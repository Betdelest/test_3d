<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Projet BETL</title>

<script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>

<style>
  :root {
    --bg:#0b0f14;
    --card:#0f1720;
    --muted:#9aa6b2;
    --accent:#0a84ff;
    --glass: rgba(255,255,255,0.06);
  }
  html,body{height:100%;margin:0;background:var(--bg);color:#fff;font-family:Inter,Arial,Helvetica,sans-serif}
  header{display:flex;align-items:center;gap:12px;padding:12px 16px;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);box-shadow:0 6px 18px rgba(0,0,0,0.45)}
  .logo{height:52px;width:52px;object-fit:contain;border-radius:8px;cursor:pointer}
  .title{font-weight:700;font-size:18px}
  .top-controls{margin-left:auto;display:flex;gap:8px;align-items:center}
  .pill{background:var(--glass);border-radius:10px;padding:8px 12px;border:0;color:#fff;cursor:pointer}
  .pill.primary{background:var(--accent);color:#000;font-weight:600}
  .container{padding:14px;display:grid;grid-template-columns:1fr 360px;gap:12px}
  main.card{background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);border-radius:12px;padding:10px;min-height:60vh}
  aside.card{background:var(--card);border-radius:12px;padding:12px;max-height:78vh;overflow:auto}
  model-viewer{width:100%;height:62vh;border-radius:10px;background:#111}
  .progress-wrap{display:flex;align-items:center;gap:10px;margin-top:10px}
  .progress{flex:1;height:10px;background:#111;border-radius:999px;overflow:hidden}
  .progress > span{display:block;height:100%;width:0;background:linear-gradient(90deg,var(--accent),#4bd3ff);transition:width .2s}
  .progress-label{min-width:48px;text-align:right;color:var(--muted);font-size:13px}
  .plan-item{display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:8px;background:#0b1116;margin-bottom:8px}
  .plan-item .name{max-width:66%;font-size:14px;word-break:break-word;color:#e6eef8}
  .plan-actions{display:flex;gap:8px}
  .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:none;align-items:center;justify-content:center;z-index:1200}
  .modal{width:min(1000px,96%);height:min(84vh,900px);background:#08101a;border-radius:10px;overflow:hidden;display:flex;flex-direction:column}
  .modal-header{padding:10px;background:#07101a;display:flex;justify-content:space-between;align-items:center}
  .modal-body{flex:1;background:#fff}
  .preview-iframe{width:100%;height:100%;border:0}
  .splash{position:fixed;inset:0;background:#000;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:2000}
  .splash.hidden{opacity:0;pointer-events:none;transition:opacity .35s}
  .splash-logo{width:220px;max-width:60vw;margin-bottom:8px;filter:drop-shadow(0 8px 30px rgba(0,0,0,0.6))}
  @media (max-width:980px){
    .container{grid-template-columns:1fr; padding:10px}
    aside.card{order:2}
    main.card{order:1}
    model-viewer{height:48vh}
  }
</style>
</head>
<body>

<!-- SPLASH -->
<div id="splash" class="splash">
  <img src="BETL.png" alt="BETL" class="splash-logo" onerror="this.style.display='none'">
  <div style="color:var(--muted);margin-top:6px">Chargementâ€¦ <span id="splashPct">0%</span></div>
</div>

<!-- HEADER -->
<header>
  <img src="BETL.png" alt="BETL" class="logo"
       onclick="window.open('https://www.facebook.com/BETL121','_blank')"
       onerror="this.style.display='none'">

  <div>
    <div class="title">BETL â€” Visualisation 3D & Plans</div>
    <div style="font-size:12px;color:var(--muted)">Voir ta maison avant de l'habiter</div>
  </div>

  <div class="top-controls">
    <button class="pill" onclick="openPlans()">ðŸ“¥ Plans</button>
    <button class="pill primary" id="arLaunch">Voir en AR</button>
  </div>
</header>

<!-- CONTENT -->
<div class="container">

  <main class="card">
    <div style="display:flex;justify-content:space-between;margin-bottom:6px">
      <div style="font-weight:700">AperÃ§u 3D</div>
      <div style="color:var(--muted);font-size:12px">2 modÃ¨le(s)</div>
    </div>

    <model-viewer id="viewer" src="models/Djanet_arch.glb" ar ar-modes="scene-viewer webxr" camera-controls></model-viewer>

    
    <div class="progress-wrap">
      <div class="progress"><span id="progressBar"></span></div>
      <div class="progress-label" id="progressLabel">0%</div>
    </div>
    

  </main>

  <aside class="card">

    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
      <div style="font-weight:700">Plans & Documents</div>
      <div style="font-size:12px;color:var(--muted)">
        3 fichier(s)
      </div>
    </div>

    <div style="display:flex;gap:6px;margin-bottom:10px">
      <button class="pill" id="tabArch">Architecture</button>
      <button class="pill" id="tabGC">GÃ©nie Civil</button>
      <button class="pill" id="tabOther">Autre</button>
    </div>

    <div id="plansList"></div>

  </aside>

</div>

<!-- PREVIEW -->
<div id="previewModal" class="modal-backdrop">
  <div class="modal">
    <div class="modal-header">
      <div id="previewTitle"></div>
      <button class="pill" onclick="closePreview()">Fermer</button>
    </div>
    <div class="modal-body">
      <iframe id="previewIframe" class="preview-iframe" src=""></iframe>
    </div>
  </div>
</div>

<script>
  const MODELS = ["Djanet_arch.glb","Djanet_gc.glb"];
  const PDFS = {"Architecture":["bentelha permis -modi02 mise en page-Model.pdf"],"GC":["permis (1)-Model.pdf"],"Autre":["BETL.png"]};

  function encodePath(s){return encodeURIComponent(s).replace(/%2F/g,'/');}

  function renderPlans(cat){
    const list = document.getElementById('plansList');
    list.innerHTML='';
    const files = PDFS[cat] || [];
    if(!files.length){
      list.innerHTML='<div style="color:var(--muted)">Aucun document</div>';
      return;
    }

    files.forEach(f=>{
      const row=document.createElement('div');
      row.className='plan-item';
      const href='pdfs/'+encodePath(cat)+'/'+encodePath(f);
      row.innerHTML=`
        <div class="name">${f}</div>
        <div class="plan-actions">
          <a class="pill" href="${href}" target="_blank">Voir</a>
          <button class="pill" onclick="downloadFile('${encodePath(cat)+'/'+encodePath(f)}')">TÃ©lÃ©charger</button>
        </div>
      `;
      list.appendChild(row);
    });
  }

  document.addEventListener('DOMContentLoaded',()=>{

    if(document.getElementById('tabArch')) document.getElementById('tabArch').onclick=()=>renderPlans('Architecture');
    if(document.getElementById('tabGC')) document.getElementById('tabGC').onclick=()=>renderPlans('GC');
    if(document.getElementById('tabOther')) document.getElementById('tabOther').onclick=()=>renderPlans('Autre');

    if(true) renderPlans('Architecture');
    else if(true) renderPlans('GC');
    else if(true) renderPlans('Autre');

    const viewer=document.getElementById('viewer');
    if(viewer){
      viewer.addEventListener('progress',e=>{
        const pct=Math.floor((e.detail.totalProgress||0)*100);
        document.getElementById('progressBar').style.width=pct+'%';
        document.getElementById('progressLabel').textContent=pct+'%';
        document.getElementById('splashPct').textContent=pct+'%';
        if(pct>=100){
          setTimeout(()=>document.getElementById('splash').classList.add('hidden'),350);
        }
      });
    }

    const ar=document.getElementById('arLaunch');
    if(ar && viewer){
      ar.onclick=async()=>{
        try{await viewer.enterAR();}
        catch(e){alert("RA non supportÃ©e â€” ouvre avec Chrome Android.");}
      };
    }
  });

  function openPreview(title,path){
    document.getElementById('previewTitle').textContent=title;
    document.getElementById('previewIframe').src=path;
    document.getElementById('previewModal').style.display='flex';
  }
  function closePreview(){
    document.getElementById('previewIframe').src='';
    document.getElementById('previewModal').style.display='none';
  }

  function downloadFile(relPath){
    const url=relPath;
    fetch(url).then(r=>r.blob()).then(blob=>{
      const a=document.createElement('a');
      a.href=URL.createObjectURL(blob);
      a.download=decodeURIComponent(relPath.split('/').pop());
      a.click(); URL.revokeObjectURL(a.href);
    }).catch(()=>window.open(url,'_blank'));
  }
</script>

</body>
</html>