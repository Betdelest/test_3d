<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Projet BETL</title>
<script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>

<style>
/* --- THEME & COLORS --- */
:root{
  --bg:#050816;
  --card:#07102a;
  --muted:#9aa6b2;
  --accent:#0a84ff;
  --plan-bg: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
}

/* --- GLOBAL --- */
html,body{
  height:100%;
  margin:0;
  background:var(--bg);
  color:#fff;
  font-family:Inter,Arial,Helvetica,sans-serif
}

/* --- HEADER --- */
header{
  display:flex;
  align-items:center;
  gap:12px;
  padding:10px 14px;
  background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);
  box-shadow:0 6px 18px rgba(0,0,0,0.35)
}

.logo{
  height:72px;
  width:72px;
  object-fit:contain;
  border-radius:8px;
  cursor:pointer;
  flex:0 0 auto
}

.titleWrap{display:flex;flex-direction:column;align-items:flex-start}
.title{font-weight:800;font-size:20px;margin:0}
.subtitle{font-size:12px;color:var(--muted);margin-top:2px}

/* --- SELECT MODEL --- */
.hdr-controls{
  margin-left:18px;
  display:flex;
  gap:8px;
  align-items:center
}
select.model-select{
  background:transparent;
  border:1px solid rgba(255,255,255,0.06);
  border-radius:8px;
  padding:8px 10px;
  color:#fff;
  min-width:180px
}

/* --- LAYOUT --- */
.container{
  padding:12px;
  display:grid;
  grid-template-columns:1fr 360px;
  gap:12px
}

main.card{
  background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);
  border-radius:10px;
  padding:10px;
  min-height:60vh
}

aside.card{
  background:var(--card);
  border-radius:10px;
  padding:12px;
  max-height:78vh;
  overflow:auto
}

/* --- VIEWER --- */
model-viewer{
  width:100%;
  height:58vh;
  border-radius:10px;
  background:#111;
  display:block
}

/* --- LOADER --- */
.progress-wrap{display:flex;align-items:center;gap:10px;margin-top:10px}
.progress{flex:1;height:10px;background:#111;border-radius:999px;overflow:hidden}
.progress > span{
  height:100%;
  width:0;
  display:block;
  background:linear-gradient(90deg,var(--accent),#4bd3ff);
  transition:width .2s
}
.progress-label{min-width:44px;text-align:right;color:var(--muted);font-size:13px}

/* --- PLANS & DOCUMENTS --- */
.plans-docs{
  background:linear-gradient(180deg, rgba(4,12,24,0.75), rgba(3,10,20,0.95));
  color:#e6f0fb;
  padding:18px;
  border-radius:8px;
  margin-top:8px;
  border:1px solid rgba(255,255,255,0.03)
}

.pd-header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  margin-bottom:12px
}

.pd-search{
  background:transparent;
  border:1px solid rgba(255,255,255,0.04);
  padding:8px 12px;
  border-radius:10px;
  color:var(--muted);
  width:100%;
  margin-bottom:12px
}

.pd-categories{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
  margin-bottom:15px
}

.pd-category-btn{
  background:transparent;
  border:1px solid rgba(255,255,255,0.06);
  padding:6px 10px;
  border-radius:999px;
  font-size:0.82rem;
  color:var(--muted);
  cursor:pointer
}

.pd-category-btn.active{
  background:linear-gradient(90deg,var(--accent),#4cc3ff);
  color:#051225;
  box-shadow:0 6px 22px rgba(46,166,255,0.08)
}

.pd-grid{display:grid;grid-template-columns:1fr;gap:8px}
.pd-card{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:8px;
  border-radius:8px;
  background:var(--plan-bg);
  border:1px solid rgba(255,255,255,0.03)
}

.pd-title{font-size:0.95rem}
.pd-meta{font-size:0.82rem;color:var(--muted)}

.btn{
  padding:8px 10px;
  border-radius:8px;
  border:0;
  background:var(--accent);
  color:#021826;
  cursor:pointer;
  font-weight:700
}

.btn-ghost{
  background:transparent;
  border:1px solid rgba(255,255,255,0.04);
  color:var(--muted);
  padding:6px 10px;
  border-radius:8px
}

/* FOOTER BETL */
.betl-footer{
  margin-top:25px;
  padding:18px;
  text-align:center;
  color:#8fa3b5;
  font-size:13px;
  border-top:1px solid rgba(255,255,255,0.05);
  background:rgba(255,255,255,0.02);
  border-radius:10px;
}
.betl-footer .f-title{font-size:15px;color:#fff;font-weight:700}
.betl-footer .f-slogan{color:#4cc3ff;margin-bottom:8px;font-size:12px}
.betl-footer .f-line{margin-top:4px}
.betl-footer .f-copy{margin-top:10px;font-size:11px;color:#6f7c88}

</style>
</head>
<body>
<!-- SPLASH -->
<div id="splash" class="splash">
  <img src="BETL.png" alt="BETL" class="splash-logo" onerror="this.style.display='none'">
  <div style="color:var(--muted);margin-top:6px">Chargement‚Ä¶ <span id="splashPct">0%</span></div>
</div>

<!-- HEADER -->
<header>
  <img src="BETL.png" alt="BETL" class="logo"
       onclick="window.open('https://www.facebook.com/BETL120','_blank')"
       onerror="this.style.display='none'">

  <div class="titleWrap">
    <div class="title">BETL ‚Äî Visualisation 3D & Plans</div>
    <div class="subtitle">Voir ta maison avant de l'habiter</div>
  </div>

  <div class="hdr-controls" id="hdrControls"></div>
</header>

<!-- CONTENT -->
<div class="container">

  <!-- LEFT : 3D VIEWER -->
  <main class="card">
    <div style="display:flex;justify-content:space-between;margin-bottom:6px">
      <div style="font-weight:700">Aper√ßu 3D</div>
      <div style="color:var(--muted);font-size:12px">
        2 mod√®le(s)
      </div>
    </div>

    <div style="text-align:center">
      <model-viewer id="viewer"
                src="models/Djanet_arch.glb"
                ar ar-modes="scene-viewer webxr"
                camera-controls exposure="1">
                <button slot="ar-button" class="ar-button">
                  Voir en R√©alit√© Augment√©e
                </button>
             </model-viewer>
    </div>

    <div id="progressWrap" class="progress-wrap" style="">
      <div class="progress"><span id="progressBar"></span></div>
      <div class="progress-label" id="progressLabel">0%</div>
    </div>

    <div id="statusMsg" style="margin-top:8px;color:var(--muted);font-size:13px"></div>
  </main>

  <!-- RIGHT : DOCUMENTS -->
  <aside class="card">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px">
      <div style="font-weight:700">Plans & Documents</div>
      <div style="font-size:12px;color:var(--muted)">
        3 fichier(s)
      </div>
    </div>

    <!-- MODERN BLOCK -->
    <div class="plans-docs" id="plansDocsRoot">

      <header class="pd-header">
        <h3>Plans & Documents</h3>
      </header>

      <input id="pd-search" class="pd-search"
             placeholder="Rechercher un document..." aria-label="Recherche documents">

      <div id="pd-categories" class="pd-categories"></div>

      <main id="pd-grid" class="pd-grid"></main>

    </div>

    <!-- FOOTER (INSIDE ASIDE FOR CLEAN LAYOUT) -->
    <footer class="betl-footer">
      <div class="f-title">BETL ‚Äî Bureau d‚Äô√âtudes Techniques</div>
      <div class="f-slogan">Voir ta maison avant de l'habiter</div>

      <div class="f-line">üìç Z.I Chihani Bachir, El Khroub, Constantine</div>

      <div class="f-line">üìû 0558 11 55 36 ‚Ä¢ üìß bureautechniquedelest@gmail.com</div>

      <div class="f-line">üåê Facebook : BETL120</div>

      <div class="f-copy">¬© 2025 BETL ‚Äî Tous droits r√©serv√©s</div>
    </footer>

  </aside>
</div>

<!-- PDF PREVIEW MODAL -->
<div id="previewModal" class="modal-backdrop">
  <div class="modal">
    <div class="modal-header">
      <div id="previewTitle"></div>
      <button class="btn-ghost" onclick="closePreview()">Fermer</button>
    </div>
    <div class="modal-body">
      <iframe id="previewIframe" class="preview-iframe"></iframe>
    </div>
  </div>
</div>

<script>
/* Injected data */
const MODELS = ["Djanet_arch.glb","Djanet_gc.glb"];
const PDFS = {"Architecture":["bentelha permis -modi02 mise en page-Model.pdf"],"GC":["permis (1)-Model.pdf"],"Autre":["BETL.png"]};

/* Header selector */
(function initHeaderSelector(){
  const hdr = document.getElementById('hdrControls');
  if(!hdr || !MODELS.length) return;

  const sel = document.createElement('select');
  sel.className = 'model-select';

  const opt0 = document.createElement('option');
  opt0.textContent = 'Choisir mod√®le 3D';
  opt0.value = '';
  sel.appendChild(opt0);

  const archs = MODELS.filter(m => /arch|architect/i.test(m));
  const gcs  = MODELS.filter(m => /gc|genie|civil/i.test(m));

  archs.forEach(m=>{
    const o=document.createElement('option');
    o.textContent='Architecture ‚Äî '+m;
    o.value='models/'+encodeURIComponent(m);
    sel.appendChild(o)
  });

  gcs.forEach(m=>{
    const o=document.createElement('option');
    o.textContent='G√©nie Civil ‚Äî '+m;
    o.value='models/'+encodeURIComponent(m);
    sel.appendChild(o)
  });

  MODELS.forEach(m=>{
    if(archs.includes(m) || gcs.includes(m)) return;
    const o=document.createElement('option');
    o.textContent=m;
    o.value='models/'+encodeURIComponent(m);
    sel.appendChild(o);
  });

  sel.onchange = ()=> {
    const v=document.getElementById('viewer');
    if(v && sel.value) v.src=sel.value;
  };

  hdr.appendChild(sel);
})();

/* Prepare documents array */
(function(){
  const docs=[];
  Object.keys(PDFS).forEach(cat=>{
    const pretty=(cat==="GC"?"G√©nie Civil":cat);
    PDFS[cat].forEach(f=>{
      docs.push({
        title:f,
        category:pretty,
        file:'pdfs/'+cat+'/'+encodeURIComponent(f)
      });
    });
  });
  window.INITIAL_DOCS=docs;
})();

/* Plans & Documents UI */
(function(){
  const documents = window.INITIAL_DOCS;
  const pdGrid = document.getElementById('pd-grid');
  const pdCats = document.getElementById('pd-categories');
  const pdSearch = document.getElementById('pd-search');

  let activeCategory = "Tous";

  function getCategories(){
    const base=["Tous","Architecture","G√©nie Civil","Autre"];
    const found=[...new Set(documents.map(d=>d.category))];
    return base.filter(c => c==="Tous" || found.includes(c));
  }

  function renderCategories(){
    pdCats.innerHTML="";
    getCategories().forEach(cat=>{
      const btn=document.createElement('button');
      btn.className='pd-category-btn';
      btn.textContent=cat;
      if(cat===activeCategory) btn.classList.add('active');
      btn.onclick = ()=> {
        activeCategory=cat;
        renderCategories();
        renderGrid();
      };
      pdCats.appendChild(btn);
    });
  }

  function renderGrid(){
    const q=pdSearch.value.trim().toLowerCase();
    pdGrid.innerHTML="";

    const filtered = documents.filter(d=>{
      const matchCat=(activeCategory==="Tous" || d.category===activeCategory);
      const matchSearch=d.title.toLowerCase().includes(q);
      return matchCat && matchSearch;
    });

    if(!filtered.length){
      const empty=document.createElement('div');
      empty.style="padding:12px;text-align:center;color:var(--muted)";
      empty.textContent="Aucun document trouv√©.";
      pdGrid.appendChild(empty);
      return;
    }

    filtered.forEach(doc=>{
      const card=document.createElement('article');
      card.className='pd-card';

      const left=document.createElement('div');
      left.style.flex="1";

      const t=document.createElement('div');
      t.className='pd-title';
      t.textContent=doc.title;

      const m=document.createElement('div');
      m.className='pd-meta';
      m.textContent=doc.category;

      left.appendChild(t);
      left.appendChild(m);

      const actions=document.createElement('div');
      actions.style.display='flex';
      actions.style.gap='8px';

      const bView=document.createElement('button');
      bView.className='btn';
      bView.textContent='Voir';
      bView.onclick = ()=> openPreview(doc.title,doc.file);

      const bDetails=document.createElement('button');
      bDetails.className='btn-ghost';
      bDetails.textContent='D√©tails';
      bDetails.onclick = ()=> alert("D√©tails: "+doc.title);

      actions.appendChild(bView);
      actions.appendChild(bDetails);

      card.appendChild(left);
      card.appendChild(actions);

      pdGrid.appendChild(card);
    });
  }

  // Search update
  pdSearch.oninput = ()=> renderGrid();

  renderCategories();
  renderGrid();
})();

/* Preview Modal */
function openPreview(title,path){
  document.getElementById('previewTitle').textContent=title;
  document.getElementById('previewIframe').src=path;
  document.getElementById('previewModal').style.display='flex';
}
function closePreview(){
  document.getElementById('previewIframe').src="";
  document.getElementById('previewModal').style.display='none';
}
window.closePreview=closePreview;

/* Viewer loader */
document.addEventListener('DOMContentLoaded',()=>{
  const viewer=document.getElementById('viewer');
  if(!viewer) return;
  const pbar=document.getElementById('progressBar');
  const plabel=document.getElementById('progressLabel');
  const splash=document.getElementById('splash');
  const wrap=document.getElementById('progressWrap');

  viewer.addEventListener('progress',e=>{
    const pct=Math.floor((e.detail.totalProgress||0)*100);
    if(pbar) pbar.style.width=pct+'%';
    if(plabel) plabel.textContent=pct+'%';
    if(document.getElementById('splashPct'))
      document.getElementById('splashPct').textContent=pct+'%';

    if(pct>=100){
      setTimeout(()=> splash.classList.add('hidden'),350);
      setTimeout(()=>{ wrap.style.opacity='0'; wrap.style.pointerEvents='none'; },600);
    }
  });
});
</script>

</body>
</html>